<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כותב +AI - עוזר כתיבת החיבורים שלך</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .step-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        /* עיצוב מיוחד לדף השער */
        .homepage-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: none;
            border-left: none;
            text-align: center;
            padding: 40px 25px;
        }

        .homepage-card h3 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .homepage-card .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .essay-type-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .essay-type-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #e9ecef;
            border-radius: 20px;
            padding: 35px 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .essay-type-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .essay-type-card > * {
            position: relative;
            z-index: 2;
        }

        .essay-type-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .essay-type-card:hover::before {
            opacity: 1;
        }

        .essay-type-card:hover h4,
        .essay-type-card:hover p {
            color: white;
        }

        .essay-type-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .essay-type-card h4 {
            font-size: 1.6em;
            margin-bottom: 15px;
            transition: color 0.3s ease;
            color: #2c3e50;
        }

        .essay-type-card .emoji {
            font-size: 3.5em;
            margin-bottom: 15px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .essay-type-card p {
            color: #6c757d;
            font-size: 1.1em;
            line-height: 1.6;
            transition: color 0.3s ease;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .textarea-large {
            min-height: 100px;
            resize: vertical;
        }

        .input-with-spell-check {
            position: relative;
        }

        .spell-check-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .spell-check-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .spell-check-btn.checking {
            background: #ffc107;
            cursor: not-allowed;
        }

        .spell-error {
            background-color: #ffe6e6 !important;
            border-color: #ff6b6b !important;
        }

        .spell-warning {
            background-color: #fff3cd !important;
            border-color: #ffc107 !important;
        }

        .spell-success {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }

        .spelling-suggestions {
            background: #fff;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideDown 0.3s ease;
            max-height: 400px;
            overflow-y: auto;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spelling-suggestions h5 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 1px solid #ffc107;
            padding-bottom: 8px;
        }

        .suggestion-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .suggestion-item:hover {
            background: #e9ecef;
            transform: translateX(-3px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .suggestion-item.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .suggestion-item.error:hover {
            background: #ffe6e6;
        }

        .suggestion-item.warning {
            border-left-color: #ffc107;
            background: #fffbf0;
        }

        .suggestion-item.info {
            border-left-color: #17a2b8;
            background: #f0f9ff;
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-arrow {
            color: #28a745;
            font-weight: bold;
            font-size: 16px;
        }

        .suggestion-text {
            color: #28a745;
            font-weight: bold;
        }

        .apply-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .apply-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .suggestion-message {
            color: #6c757d;
            font-size: 12px;
            margin-top: 5px;
            font-style: italic;
        }

        .alternatives {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #dee2e6;
            font-size: 12px;
            color: #495057;
        }

        .alt-suggestion {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 10px;
            cursor: pointer;
            margin: 0 2px;
            transition: background 0.3s ease;
        }

        .alt-suggestion:hover {
            background: #007bff;
            color: white;
        }

        .suggestion-category {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0,0,0,0.1);
            color: #495057;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .fix-all-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #dee2e6;
            text-align: center;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .fix-all-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .ignore-all-btn {
            background: #6c757d;
        }

        .fix-all-btn:hover {
            background: linear-gradient(45deg, #218838, #1ea88a);
        }

        .ignore-all-btn:hover {
            background: #5a6268;
        }

        .spell-check-controls {
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #2196f3;
        }

        .spell-check-controls h4 {
            color: #1565c0;
            margin-bottom: 15px;
            text-align: center;
        }

        .spell-check-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .spell-check-option {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e3f2fd;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .spell-check-option:hover {
            border-color: #2196f3;
            transform: translateY(-2px);
        }

        .spell-check-option.selected {
            background: #2196f3;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tips-box {
            background: linear-gradient(45deg, #e3f2fd, #90caf9);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid #2196f3;
        }

        .tips-box h4 {
            color: #1565c0;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }

        .tip-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .tip-section h5 {
            color: #0d47a1;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .tip-section ul {
            padding-right: 20px;
            margin-bottom: 10px;
        }

        .tip-section li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .example-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-style: italic;
            color: #495057;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .progress-indicator {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #667eea;
            font-weight: bold;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffe6e6;
            border: 2px solid #ff6b6b;
            color: #d63031;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        .success-message {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .essay-type-cards {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .spell-check-options {
                grid-template-columns: 1fr;
            }

            .essay-type-card .emoji {
                font-size: 2.5em;
            }

            .essay-type-card h4 {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>כותב +AI ✍️</h1>
            <p>העוזר החכם שלך לכתיבת חיבורים מעולים עם בדיקת שגיאות כתיב!</p>
        </div>

        <div class="main-content">
            <!-- דף שער נקי - בחירת סוג חיבור בלבד -->
            <div class="step-content active" id="essayTypeSelection">
                <div class="card homepage-card">
                    <h3>ברוכים הבאים למערכת כתיבת החיבורים! 🎓</h3>
                    <p class="subtitle">בחר את סוג החיבור שברצונך לכתוב וקבל מתווה מותאם אישית עם בדיקת שגיאות כתיב מתקדמת</p>
                    
                    <div class="essay-type-cards">
                        <div class="essay-type-card" onclick="selectEssayType('argumentative')">
                            <div class="emoji">⚖️</div>
                            <h4>חיבור טיעוני</h4>
                            <p>הצגת עמדה עם טיעונים חזקים, התייחסות לטענת נגד והפרכתה. מתאים לנושאים שנויים במחלוקת.</p>
                        </div>
                        
                        <div class="essay-type-card" onclick="selectEssayType('descriptive')">
                            <div class="emoji">🎨</div>
                            <h4>כתיבה יצירתית</h4>
                            <p>יצירת סיפור, תיאור חוויה או זיכרון באופן יצירתי ומעניין. כולל בניית דמויות ועלילה.</p>
                        </div>
                        
                        <div class="essay-type-card" onclick="selectEssayType('formal_letter')">
                            <div class="emoji">📋</div>
                            <h4>מכתב רשמי</h4>
                            <p>כתיבת מכתב למוסד, בית ספר או גורם רשמי. כולל מבנה נכון ושפה מתאימה.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חיבור טיעוני -->
            <div class="step-content" id="argumentative">
                <div class="progress-indicator">תכנון חיבור טיעוני ⚖️</div>
                
                <button class="btn-secondary back-btn" onclick="goBack()">← חזרה לבחירת סוג חיבור</button>

                <!-- מודול בדיקת שגיאות כתיב -->
                <div class="spell-check-controls">
                    <h4>🔍 הגדרות בדיקת שגיאות כתיב ותחביר</h4>
                    <div class="spell-check-options">
                        <div class="spell-check-option selected" data-method="basic">
                            <strong>בדיקה בסיסית</strong><br>
                            <small>בדיקת מילים נפוצות ותחביר בסיסי</small>
                        </div>
                        <div class="spell-check-option" data-method="advanced">
                            <strong>בדיקה מתקדמת</strong><br>
                            <small>בדיקה מעמיקה עם AI</small>
                        </div>
                        <div class="spell-check-option" data-method="languagetool">
                            <strong>LanguageTool</strong><br>
                            <small>בדיקה מקצועית (דורש חיבור לאינטרנט)</small>
                        </div>
                    </div>
                    <p style="text-align: center; font-size: 14px; color: #666;">
                        💡 המערכת תבדוק שגיאות כתיב ותחביר אוטומטית בזמן הכתיבה
                    </p>
                </div>
                
                <div class="card">
                    <h3>תכנון הכתיבה היצירתית שלך 🎨</h3>
                    
                    <div class="input-group">
                        <label for="descTopic">רעיון ראשוני - על מה תרצה לכתוב?</label>
                        <div class="input-with-spell-check">
                            <input type="text" id="descTopic" placeholder="למשל: סיפור, זכרון ילדות, דמיון, סיטואציה" oninput="checkSpelling(this)">
                            <button class="spell-check-btn" onclick="manualSpellCheck('descTopic')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="descMainImpression">אפיון דמויות ומקום</label>
                        <div class="input-with-spell-check">
                            <textarea id="descMainImpression" class="textarea-large" placeholder="מיהן הדמויות הראשיות? היכן מתרחש הסיפור? באיזה תקופה? איך הדמויות מרגישות?" oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('descMainImpression')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="descAspects">בניית עלילה:</label>
                        <div class="input-with-spell-check">
                            <textarea id="descAspects" class="textarea-large" placeholder="פתיחה, בעיה/קונפליקט, שיא, פתרון, סיום..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('descAspects')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="descSenses">כתיבה סגנונית:</label>
                        <div class="input-with-spell-check">
                            <textarea id="descSenses" class="textarea-large" placeholder="שימוש במטאפורות, דימויים, שאלות ריטוריות, כתיב בגוף ראשון/שלישי, כתיבה חושית: מה שומעים? רואים? מריחים? מרגישים? שילוב מונולוג פנימי או דיאלוגים..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('descSenses')">✓ בדוק</button>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn-secondary" onclick="checkAllSpelling('descriptive')">🔍 בדוק שגיאות בכל הטקסט</button>
                        <button class="btn-primary" onclick="generateOutline('descriptive')">צור מתווה לחיבור 🚀</button>
                    </div>
                    <div id="descOutline"></div>
                </div>

                <div class="tips-box">
                    <h4>🎨 טיפים לכתיבה יצירתית מוצלחת</h4>
                    
                    <div class="tip-section">
                        <h5>🌟 עקרונות בסיסיים</h5>
                        <ul>
                            <li>לכתוב פתיחה מסקרנת</li>
                            <li>לבנות עלילה ברורה</li>
                            <li>להתחיל מרגש חזק</li>
                            <li>להפעיל את החושים</li>
                            <li>להשתמש בשפה עשירה ומגוונת</li>
                            <li>לשלב דיאלוגים ומונולוג פנימי</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- מכתב רשמי -->
            <div class="step-content" id="formal_letter">
                <div class="progress-indicator">תכנון מכתב רשמי 📋</div>
                
                <button class="btn-secondary back-btn" onclick="goBack()">← חזרה לבחירת סוג חיבור</button>

                <div class="spell-check-controls">
                    <h4>🔍 הגדרות בדיקת שגיאות כתיב ותחביר</h4>
                    <div class="spell-check-options">
                        <div class="spell-check-option selected" data-method="basic">
                            <strong>בדיקה בסיסית</strong><br>
                            <small>בדיקת מילים נפוצות ותחביר בסיסי</small>
                        </div>
                        <div class="spell-check-option" data-method="advanced">
                            <strong>בדיקה מתקדמת</strong><br>
                            <small>בדיקה מעמיקה עם AI</small>
                        </div>
                        <div class="spell-check-option" data-method="languagetool">
                            <strong>LanguageTool</strong><br>
                            <small>בדיקה מקצועית (דורש חיבור לאינטרנט)</small>
                        </div>
                    </div>
                    <p style="text-align: center; font-size: 14px; color: #666;">
                        💡 המערכת תבדוק שגיאות כתיב ותחביר אוטומטית בזמן הכתיבה
                    </p>
                </div>
                
                <div class="card">
                    <h3>תכנון המכתב הרשמי שלך 📋</h3>
                    
                    <div class="input-group">
                        <label for="formalPurpose">מה המטרה של המכתב?</label>
                        <div class="input-with-spell-check">
                            <input type="text" id="formalPurpose" placeholder="למשל: בקשה לדחיית בחינה, תלונה על שירות, בקשה למלגה, כתיבת המלצה" oninput="checkSpelling(this)">
                            <button class="spell-check-btn" onclick="manualSpellCheck('formalPurpose')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="formalRecipient">למי אתה פונה?</label>
                        <div class="input-with-spell-check">
                            <input type="text" id="formalRecipient" placeholder="למשל: מנהל בית הספר, מחלקת שירות לקוחות, ועדת מלגות" oninput="checkSpelling(this)">
                            <button class="spell-check-btn" onclick="manualSpellCheck('formalRecipient')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="formalMainPoints">נקודות עיקריות שברצונך להעביר:</label>
                        <div class="input-with-spell-check">
                            <textarea id="formalMainPoints" class="textarea-large" placeholder="נקודה 1: הבעיה או הבקשה...&#10;נקודה 2: הסיבות והנסיבות...&#10;נקודה 3: מה אתה מבקש לקבל..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('formalMainPoints')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="formalDetails">פרטים רלוונטיים (תאריכים, מספרי אסמכתא וכו'):</label>
                        <div class="input-with-spell-check">
                            <textarea id="formalDetails" class="textarea-large" placeholder="רשום פרטים חשובים שצריך לכלול במכתב..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('formalDetails')">✓ בדוק</button>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn-secondary" onclick="checkAllSpelling('formal_letter')">🔍 בדוק שגיאות בכל הטקסט</button>
                        <button class="btn-primary" onclick="generateOutline('formal_letter')">צור מתווה למכתב 🚀</button>
                    </div>
                    <div id="formalOutline"></div>
                </div>

                <div class="tips-box">
                    <h4>📋 טיפים למכתב רשמי מוצלח</h4>
                    
                    <div class="tip-section">
                        <h5>🏗️ מבנה נדרש</h5>
                        <ul>
                            <li>כתובת השולח ותאריך (בראש המכתב)</li>
                            <li>כתובת הנמען ונושא המכתב</li>
                            <li>פנייה מנומסת ("אדון/גברת נכבד/ה")</li>
                            <li>גוף המכתב - הבהרת המטרה ופירוט הבקשה</li>
                            <li>סיום מנומס וחתימה</li>
                        </ul>
                        <div class="example-box">
                            <strong>דוגמה לפתיחה:</strong> "הנדון: בקשה לדחיית מועד בחינה<br>אדון/גברת נכבד/ה,<br>אני פונה אליכם בעניין בקשה לדחיית מועד בחינה..."
                        </div>
                    </div>

                    <div class="tip-section">
                        <h5>💼 שפה וסגנון</h5>
                        <ul>
                            <li>השתמש בשפה רשמית</li>
                            <li>הבהר את המטרה כבר בפסקה הראשונה</li>
                            <li>היה ברור ומדויק בבקשתך</li>
                        </ul>
                        <div class="example-box">
                            <strong>ביטויים מועילים:</strong> "אני פונה אליכם בעניין...", "אודה לקבל מענה בהקדם", "בכבוד רב", "בתודה מראש"
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentEssayType = '';
        let essayData = {};
        let spellCheckMethod = 'basic';
        let spellCheckTimeout = null;

        // מילון עברי מורחב לבדיקה אמיתית
        const hebrewDictionary = {
            common: [
                // מילים בסיסיות
                'אני', 'אתה', 'את', 'הוא', 'היא', 'אנחנו', 'אתם', 'אתן', 'הם', 'הן',
                'של', 'על', 'אל', 'עם', 'לא', 'כן', 'מה', 'מי', 'איפה', 'מתי', 'איך', 'למה', 'כמה',
                'זה', 'זו', 'זאת', 'אלה', 'אלו',
                
                // מילים נפוצות בחיבורים
                'בית', 'ספר', 'חיבור', 'טיעון', 'דעה', 'רעיון', 'בעיה', 'פתרון', 'דוגמה', 'הוכחה', 'מסקנה',
                'ראשית', 'שנית', 'שלישית', 'לבסוף', 'לכן', 'אולם', 'אך', 'בנוסף', 'יתר', 'כן',
                'לדעתי', 'לטענתי', 'למעשה', 'בפועל', 'במציאות', 'חשוב', 'נחוץ', 'הכרחי',
                'אפשר', 'צריך', 'חייב', 'רוצה', 'יכול', 'מצליח', 'נכון', 'שגוי', 'טוב', 'רע',
                
                // פעלים נפוצים
                'הולך', 'הולכת', 'בא', 'באה', 'רואה', 'שומע', 'אוכל', 'שותה', 'לומד', 'לומדת',
                'כותב', 'כותבת', 'קורא', 'קוראת', 'משחק', 'משחקת', 'עובד', 'עובדת',
                'חושב', 'חושבת', 'מבין', 'מבינה', 'יודע', 'יודעת', 'מכיר', 'מכירה',
                
                // מילים בכתיבה יצירתית
                'סיפור', 'זכרון', 'דמיון', 'רגש', 'רגשות', 'חוויה', 'התרחש', 'קרה', 'אירע',
                'דמות', 'דמויות', 'מקום', 'זמן', 'עלילה', 'פתיחה', 'סיום', 'שיא',
                
                // מילים במכתב רשמי
                'מכתב', 'בקשה', 'פנייה', 'תלונה', 'המלצה', 'נושא', 'נמען', 'כתובת',
                'מנהל', 'מנהלת', 'מחלקה', 'לקוח', 'לקוחה', 'שירות', 'עובד', 'עובדת',
                'אדון', 'גברת', 'נכבד', 'נכבדה', 'כבוד', 'תודה', 'תקווה', 'בברכה'
            ],
            
            errors: {
                'בעייה': 'בעיה',
                'שיכבה': 'שכבה',
                'הולכ': 'הולך',
                'באו': 'בואו',
                'תודה': 'תודה',
                'בבקשה': 'בבקשה',
                'שלום': 'שלום'
            }
        };

        // הגדרת אופן בדיקת השגיאות - רק בדפי החיבור
        function initializeSpellCheckOptions() {
            const spellCheckOptions = document.querySelectorAll('.spell-check-option');
            spellCheckOptions.forEach(option => {
                option.addEventListener('click', function() {
                    spellCheckOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    spellCheckMethod = this.dataset.method;
                    showSuccessMessage(`נבחרה שיטת בדיקה: ${this.querySelector('strong').textContent}`);
                });
            });
        }

        function selectEssayType(type) {
            try {
                document.querySelectorAll('.essay-type-card').forEach(card => {
                    card.classList.remove('selected');
                });

                if (event && event.target) {
                    const clickedCard = event.target.closest('.essay-type-card');
                    if (clickedCard) {
                        clickedCard.classList.add('selected');
                    }
                }

                setTimeout(() => {
                    currentEssayType = type;
                    showStep(type);
                }, 300);
            } catch (error) {
                console.log('Navigation error');
            }
        }

        function showStep(stepId) {
            try {
                clearMessages();
                
                document.querySelectorAll('.step-content').forEach(step => {
                    step.classList.remove('active');
                });

                const targetStep = document.getElementById(stepId);
                if (targetStep) {
                    targetStep.classList.add('active');
                    
                    if (stepId !== 'essayTypeSelection') {
                        setTimeout(initializeSpellCheckOptions, 100);
                    }
                    
                    window.scrollTo(0, 0);
                }
            } catch (error) {
                console.log('Navigation error');
            }
        }

        function goBack() {
            try {
                currentEssayType = '';
                clearMessages();
                
                document.querySelectorAll('input, textarea').forEach(input => {
                    input.value = '';
                    input.classList.remove('spell-error', 'spell-warning', 'spell-success');
                });
                
                document.querySelectorAll('.spelling-suggestions').forEach(suggestion => {
                    suggestion.remove();
                });
                
                document.querySelectorAll('#argOutline, #descOutline, #formalOutline').forEach(outline => {
                    outline.innerHTML = '';
                });
                
                showStep('essayTypeSelection');
            } catch (error) {
                console.log('Navigation error');
            }
        }

        // פונקציות בדיקת שגיאות כתיב
        function checkSpelling(element) {
            if (spellCheckTimeout) {
                clearTimeout(spellCheckTimeout);
            }

            spellCheckTimeout = setTimeout(() => {
                performSpellCheck(element);
            }, 1000);
        }

        function manualSpellCheck(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                performSpellCheck(element, true);
            }
        }

        function checkAllSpelling(sectionType) {
            const section = document.getElementById(sectionType);
            const inputs = section.querySelectorAll('input, textarea');
            
            let hasErrors = false;
            inputs.forEach(input => {
                if (input.value.trim()) {
                    const errors = performSpellCheck(input, false);
                    if (errors && errors.length > 0) {
                        hasErrors = true;
                    }
                }
            });

            if (hasErrors) {
                showErrorMessage('נמצאו שגיאות כתיב בטקסט. אנא תקן את השגיאות המסומנות.');
            } else {
                showSuccessMessage('כל הטקסט נבדק ולא נמצאו שגיאות! 🎉');
            }
        }

        async function performSpellCheck(element, showResults = true) {
            const text = element.value.trim();
            if (!text) return [];

            const btn = element.parentNode.querySelector('.spell-check-btn');
            if (btn) {
                btn.classList.add('checking');
                btn.innerHTML = 'בודק... <span class="loading-spinner"></span>';
                btn.disabled = true;
            }

            try {
                let errors = [];
                
                switch (spellCheckMethod) {
                    case 'basic':
                        errors = await basicSpellCheck(text);
                        break;
                    case 'advanced':
                        errors = await advancedSpellCheck(text);
                        break;
                    case 'languagetool':
                        errors = await languageToolCheck(text);
                        break;
                }

                updateElementSpelling(element, errors, showResults);
                return errors;

            } catch (error) {
                if (showResults) {
                    showErrorMessage('אירעה שגיאה בבדיקת הכתיב. אנא נסה שוב.');
                }
                return [];
            } finally {
                if (btn) {
                    btn.classList.remove('checking');
                    btn.innerHTML = '✓ בדוק';
                    btn.disabled = false;
                }
            }
        }

        async function basicSpellCheck(text) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const errors = [];
                    const words = text.split(/\s+/);
                    
                    words.forEach((word, index) => {
                        const cleanWord = word.replace(/[^\u0590-\u05FF\u0020-\u007F]/g, '').toLowerCase();
                        
                        if (cleanWord && hebrewDictionary.errors[cleanWord]) {
                            errors.push({
                                word: cleanWord,
                                suggestion: hebrewDictionary.errors[cleanWord],
                                type: 'spelling',
                                position: index,
                                confidence: 'high'
                            });
                        }
                        
                        else if (cleanWord && 
                                !hebrewDictionary.common.includes(cleanWord) && 
                                !hebrewDictionary.errors[cleanWord] &&
                                !/^\d+$/.test(cleanWord) && 
                                cleanWord.length > 2 && 
                                /[\u0590-\u05FF]/.test(cleanWord)) { 
                            
                            const suggestions = findSimilarWords(cleanWord);
                            if (suggestions.length > 0) {
                                errors.push({
                                    word: cleanWord,
                                    suggestion: suggestions[0],
                                    alternatives: suggestions,
                                    type: 'unknown_word',
                                    position: index,
                                    confidence: 'medium'
                                });
                            }
                        }
                    });

                    const grammarErrors = checkGrammar(text);
                    errors.push(...grammarErrors);

                    resolve(errors);
                }, 500);
            });
        }

        function findSimilarWords(word) {
            const suggestions = [];
            const maxDistance = 2;
            
            hebrewDictionary.common.forEach(dictWord => {
                const distance = calculateLevenshteinDistance(word, dictWord);
                if (distance <= maxDistance && distance > 0) {
                    suggestions.push({
                        word: dictWord,
                        distance: distance
                    });
                }
            });
            
            suggestions.sort((a, b) => a.distance - b.distance);
            return suggestions.slice(0, 3).map(s => s.word);
        }
        
        function calculateLevenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }
        
        function checkGrammar(text) {
            const errors = [];
            
            if (!text.trim().endsWith('.') && !text.trim().endsWith('?') && 
                !text.trim().endsWith('!') && text.length > 10) {
                errors.push({
                    word: 'סוף המשפט',
                    suggestion: 'הוסף סימן פיסוק בסוף המשפט',
                    type: 'punctuation',
                    confidence: 'high'
                });
            }
            
            if (text.includes('  ')) {
                errors.push({
                    word: 'רווחים כפולים',
                    suggestion: 'הסר רווחים מיותרים',
                    type: 'spacing',
                    confidence: 'high'
                });
            }
            
            const sentences = text.split(/[.!?]+/);
            sentences.forEach(sentence => {
                const trimmed = sentence.trim();
                if (trimmed && !/^[A-ZÀ-ÿ\u0590-\u05FF]/.test(trimmed)) {
                    errors.push({
                        word: 'אות ראשונה',
                        suggestion: 'התחל משפט באות גדולה',
                        type: 'capitalization',
                        confidence: 'medium'
                    });
                }
            });
            
            const words = text.split(/\s+/);
            for (let i = 0; i < words.length - 1; i++) {
                if (words[i] === words[i + 1] && words[i].length > 2) {
                    errors.push({
                        word: `חזרה על "${words[i]}"`,
                        suggestion: 'הסר חזרה מיותרת',
                        type: 'repetition',
                        confidence: 'high'
                    });
                }
            }
            
            return errors;
        }

        async function advancedSpellCheck(text) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const errors = [];
                    
                    if (text.includes('שיכבה')) {
                        errors.push({
                            word: 'שיכבה',
                            suggestion: 'שכבה',
                            type: 'spelling'
                        });
                    }
                    
                    if (text.includes('בעייה')) {
                        errors.push({
                            word: 'בעייה',
                            suggestion: 'בעיה',
                            type: 'spelling'
                        });
                    }

                    if (text.match(/אני הולכ[תה]/)) {
                        errors.push({
                            word: 'הסכמה בין נושא לנשוא',
                            suggestion: 'אני הולך (זכר) או אני הולכת (נקבה)',
                            type: 'grammar'
                        });
                    }

                    const words = text.split(/\s+/);
                    for (let i = 0; i < words.length - 1; i++) {
                        if (words[i] === words[i + 1] && words[i].length > 2) {
                            errors.push({
                                word: `חזרה על "${words[i]}"`,
                                suggestion: 'הסר חזרה מיותרת',
                                type: 'style'
                            });
                        }
                    }

                    resolve(errors);
                }, 1000);
            });
        }

        async function languageToolCheck(text) {
            try {
                const response = await fetch('https://api.languagetool.org/v2/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        'text': text,
                        'language': 'he',
                        'enabledOnly': 'false'
                    })
                });

                if (!response.ok) {
                    throw new Error('Connection error');
                }

                const data = await response.json();
                
                const errors = data.matches.map(match => ({
                    word: text.substring(match.offset, match.offset + match.length),
                    suggestion: match.replacements[0]?.value || 'אין הצעה זמינה',
                    alternatives: match.replacements.slice(1, 4).map(r => r.value),
                    type: match.rule.category.id === 'TYPOS' ? 'spelling' : 'grammar',
                    message: match.message,
                    confidence: 'high',
                    ruleId: match.rule.id,
                    category: match.rule.category.name
                }));
                
                return errors;

            } catch (error) {
                return await advancedSpellCheck(text);
            }
        }

        function updateElementSpelling(element, errors, showResults) {
            const existingSuggestions = element.parentNode.querySelector('.spelling-suggestions');
            if (existingSuggestions) {
                existingSuggestions.remove();
            }

            element.classList.remove('spell-error', 'spell-warning', 'spell-success');
            
            if (errors.length > 0) {
                const hasSpellingErrors = errors.some(e => e.type === 'spelling');
                const hasGrammarErrors = errors.some(e => e.type === 'grammar');
                
                if (hasSpellingErrors) {
                    element.classList.add('spell-error');
                } else if (hasGrammarErrors) {
                    element.classList.add('spell-warning');
                }

                if (showResults) {
                    displaySpellingSuggestions(element, errors);
                }
            } else {
                element.classList.add('spell-success');
                if (showResults) {
                    showSuccessMessage('לא נמצאו שגיאות בטקסט זה! ✓');
                }
            }
        }

        function displaySpellingSuggestions(element, errors) {
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'spelling-suggestions';
            
            let suggestionsHtml = `<h5>🔍 נמצאו ${errors.length} שגיאות אפשריות:</h5>`;
            
            errors.forEach((error, index) => {
                const errorClass = error.type === 'spelling' ? 'error' : 
                                 error.type === 'grammar' ? 'warning' : 'info';
                
                const confidenceIcon = error.confidence === 'high' ? '🎯' : 
                                      error.confidence === 'medium' ? '⚠️' : 'ℹ️';
                
                suggestionsHtml += `
                    <div class="suggestion-item ${errorClass}" onclick="applySuggestion('${element.id}', '${error.word}', '${error.suggestion}')">
                        <div class="suggestion-header">
                            ${confidenceIcon} <strong>${error.word}</strong> 
                            <span class="suggestion-arrow">→</span> 
                            <span class="suggestion-text">${error.suggestion}</span>
                            <button class="apply-btn" onclick="event.stopPropagation(); applySuggestion('${element.id}', '${error.word}', '${error.suggestion}')">החל</button>
                        </div>
                        ${error.message ? `<div class="suggestion-message">${error.message}</div>` : ''}
                        ${error.alternatives && error.alternatives.length > 0 ? 
                          `<div class="alternatives">
                             אפשרויות נוספות: ${error.alternatives.map(alt => 
                               `<span class="alt-suggestion" onclick="event.stopPropagation(); applySuggestion('${element.id}', '${error.word}', '${alt}')">${alt}</span>`
                             ).join(', ')}
                           </div>` : ''}
                        <div class="suggestion-category">${getErrorTypeText(error.type)}</div>
                    </div>
                `;
            });
            
            if (errors.length > 0) {
                suggestionsHtml += `
                    <div class="fix-all-container">
                        <button class="btn-primary fix-all-btn" onclick="fixAllSuggestions('${element.id}', ${JSON.stringify(errors).replace(/"/g, '&quot;')})">
                            🔧 תקן את כל השגיאות
                        </button>
                        <button class="btn-secondary ignore-all-btn" onclick="ignoreSuggestions('${element.id}')">
                            ❌ התעלם מההצעות
                        </button>
                    </div>
                `;
            }

            suggestionsDiv.innerHTML = suggestionsHtml;
            element.parentNode.appendChild(suggestionsDiv);
        }
        
        function getErrorTypeText(type) {
            const types = {
                'spelling': 'שגיאת כתיב',
                'grammar': 'שגיאת תחביר', 
                'punctuation': 'שגיאת פיסוק',
                'spacing': 'שגיאת רווחים',
                'capitalization': 'שגיאת אותיות גדולות',
                'repetition': 'חזרה מיותרת',
                'unknown_word': 'מילה לא מוכרת',
                'style': 'שגיאת סגנון'
            };
            return types[type] || 'שגיאה כללית';
        }
        
        function applySuggestion(elementId, originalWord, suggestion) {
            const element = document.getElementById(elementId);
            if (element) {
                const currentText = element.value;
                const regex = new RegExp('\\b' + originalWord.replace(/[.*+?^${}()|[\]\\]/g, '\\                const errors = data.matches.map(match => ({') + '\\b', 'g');
                element.value = currentText.replace(regex, suggestion);
                
                const suggestions = element.parentNode.querySelector('.spelling-suggestions');
                if (suggestions) {
                    suggestions.remove();
                }
                
                element.classList.remove('spell-error', 'spell-warning');
                element.classList.add('spell-success');
                
                showSuccessMessage(`תוקן: "${originalWord}" → "${suggestion}"`);
                
                setTimeout(() => {
                    performSpellCheck(element, false);
                }, 500);
            }
        }
        
        function fixAllSuggestions(elementId, errors) {
            const element = document.getElementById(elementId);
            if (element && errors) {
                let currentText = element.value;
                let fixedCount = 0;
                
                errors.reverse().forEach(error => {
                    if (error.confidence === 'high' || error.type === 'spelling') {
                        const regex = new RegExp('\\b' + error.word.replace(/[.*+?^${}()|[\]\\]/g, '\\                const errors = data.matches.map(match => ({') + '\\b', 'g');
                        if (regex.test(currentText)) {
                            currentText = currentText.replace(regex, error.suggestion);
                            fixedCount++;
                        }
                    }
                });
                
                element.value = currentText;
                
                const suggestions = element.parentNode.querySelector('.spelling-suggestions');
                if (suggestions) {
                    suggestions.remove();
                }
                
                element.classList.remove('spell-error', 'spell-warning');
                element.classList.add('spell-success');
                
                showSuccessMessage(`תוקנו ${fixedCount} שגיאות! 🎉`);
                
                setTimeout(() => {
                    performSpellCheck(element, false);
                }, 1000);
            }
        }
        
        function ignoreSuggestions(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                const suggestions = element.parentNode.querySelector('.spelling-suggestions');
                if (suggestions) {
                    suggestions.remove();
                }
                
                element.classList.remove('spell-error', 'spell-warning');
                element.classList.add('spell-success');
                
                showSuccessMessage('התעלמנו מההצעות');
            }
        }

        function showErrorMessage(message) {
            const activeStep = document.querySelector('.step-content.active');
            if (!activeStep || activeStep.id === 'essayTypeSelection') {
                return;
            }
            
            clearMessages();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = '⚠️ ' + message;
            
            const card = activeStep.querySelector('.card');
            if (card) {
                card.insertBefore(errorDiv, card.firstChild);
                window.scrollTo(0, 0);
            }
        }

        function showSuccessMessage(message) {
            const activeStep = document.querySelector('.step-content.active');
            if (!activeStep || activeStep.id === 'essayTypeSelection') {
                return;
            }
            
            clearMessages();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = '✅ ' + message;
            
            const card = activeStep.querySelector('.card');
            if (card) {
                card.insertBefore(successDiv, card.firstChild);
            }
        }

        function clearMessages() {
            const messages = document.querySelectorAll('.error-message, .success-message');
            messages.forEach(msg => msg.remove());
        }

        function generateOutline(type) {
            let outlineHtml = '';

            switch(type) {
                case 'argumentative':
                    const argTopic = document.getElementById('argTopic').value;
                    const argPosition = document.getElementById('argPosition').value;
                    const argArguments = document.getElementById('argArguments').value;
                    const argCounterArgument = document.getElementById('argCounterArgument').value;
                    const argRefutation = document.getElementById('argRefutation').value;
                    const argSummary = document.getElementById('argSummary').value;

                    if (!argTopic || !argPosition || !argArguments || !argCounterArgument || !argRefutation || !argSummary) {
                        showErrorMessage('אנא מלא את כל השדות כדי לקבל מתווה מותאם!');
                        return;
                    }

                    const argsList = argArguments.split('\n').filter(arg => arg.trim());
                    
                    outlineHtml = `
                        <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 10px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #2e7d32; margin-bottom: 15px;">🎯 המתווה שלך מוכן!</h4>
                            <div style="background: white; padding: 20px; border-radius: 8px;">
                                <h5 style="color: #1565c0; margin-bottom: 15px;">📝 מבנה החיבור הטיעוני:</h5>
                                <p><strong>🌟 פתיחה:</strong> הצגת הנושא "${argTopic}"</p>
                                <p><strong>🎯 הטענה שלך:</strong> ${argPosition}</p>
                                ${argsList.map((arg, index) => `<p><strong>📍 טיעון ${index + 1}:</strong> ${arg.trim()}</p>`).join('')}
                                <p><strong>⚖️ טענת הנגד:</strong> ${argCounterArgument}</p>
                                <p><strong>💪 הפרכה:</strong> ${argRefutation}</p>
                                <p><strong>🎯 סיכום והמלצה:</strong> ${argSummary}</p>
                            </div>
                            <div style="margin-top: 15px; text-align: center;">
                                <button class="btn-primary" onclick="startWriting('argumentative')">התחל לכתוב את החיבור! ✍️</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('argOutline').innerHTML = outlineHtml;
                    break;

                case 'descriptive':
                    const descTopic = document.getElementById('descTopic').value;
                    const descMainImpression = document.getElementById('descMainImpression').value;
                    const descAspects = document.getElementById('descAspects').value;
                    const descSenses = document.getElementById('descSenses').value;

                    if (!descTopic || !descMainImpression || !descAspects || !descSenses) {
                        showErrorMessage('אנא מלא את כל השדות כדי לקבל מתווה מותאם!');
                        return;
                    }

                    const aspectsList = descAspects.split('\n').filter(aspect => aspect.trim());
                    
                    outlineHtml = `
                        <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 10px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #2e7d32; margin-bottom: 15px;">🎨 המתווה שלך מוכן!</h4>
                            <div style="background: white; padding: 20px; border-radius: 8px;">
                                <h5 style="color: #1565c0; margin-bottom: 15px;">📝 מבנה הכתיבה היצירתית:</h5>
                                <p><strong>🌟 הרעיון:</strong> ${descTopic}</p>
                                <p><strong>👥 דמויות ומקום:</strong> ${descMainImpression}</p>
                                <p><strong>📖 עלילה:</strong></p>
                                ${aspectsList.map((aspect, index) => `<p><strong>🎭 שלב ${index + 1}:</strong> ${aspect.trim()}</p>`).join('')}
                                <p><strong>✨ סגנון כתיבה:</strong> ${descSenses}</p>
                            </div>
                            <div style="margin-top: 15px; text-align: center;">
                                <button class="btn-primary" onclick="startWriting('descriptive')">התחל לכתוב! ✍️</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('descOutline').innerHTML = outlineHtml;
                    break;

                case 'formal_letter':
                    const formalPurpose = document.getElementById('formalPurpose').value;
                    const formalRecipient = document.getElementById('formalRecipient').value;
                    const formalMainPoints = document.getElementById('formalMainPoints').value;
                    const formalDetails = document.getElementById('formalDetails').value;

                    if (!formalPurpose || !formalRecipient || !formalMainPoints) {
                        showErrorMessage('אנא מלא את השדות החובה כדי לקבל מתווה מותאם!');
                        return;
                    }

                    const pointsList = formalMainPoints.split('\n').filter(point => point.trim());
                    
                    outlineHtml = `
                        <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 10px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #2e7d32; margin-bottom: 15px;">📋 המתווה שלך מוכן!</h4>
                            <div style="background: white; padding: 20px; border-radius: 8px;">
                                <h5 style="color: #1565c0; margin-bottom: 15px;">📝 מבנה המכתב הרשמי:</h5>
                                <p><strong>📍 כתובת ותאריך</strong></p>
                                <p><strong>📮 נמען:</strong> ${formalRecipient}</p>
                                <p><strong>📋 מטרה:</strong> ${formalPurpose}</p>
                                <p><strong>🌟 פתיחה מנומסת</strong></p>
                                ${pointsList.map((point, index) => `<p><strong>📍 נקודה ${index + 1}:</strong> ${point.trim()}</p>`).join('')}
                                ${formalDetails ? `<p><strong>📄 פרטים נוספים:</strong> ${formalDetails}</p>` : ''}
                                <p><strong>🎯 סיום וחתימה מנומסת</strong></p>
                            </div>
                            <div style="margin-top: 15px; text-align: center;">
                                <button class="btn-primary" onclick="startWriting('formal_letter')">התחל לכתוב את המכתב! ✍️</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('formalOutline').innerHTML = outlineHtml;
                    break;
            }

            essayData[type] = {
                topic: document.getElementById(type === 'argumentative' ? 'argTopic' : 
                                             type === 'descriptive' ? 'descTopic' : 'formalPurpose').value,
                allData: Array.from(document.querySelectorAll(`#${type} input, #${type} textarea`)).reduce((acc, input) => {
                    if (input.value) acc[input.id] = input.value;
                    return acc;
                }, {})
            };
        }

        function startWriting(type) {
            const typeNames = {
                'argumentative': 'החיבור הטיעוני',
                'descriptive': 'הכתיבה היצירתית',
                'formal_letter': 'המכתב הרשמי'
            };
            
            alert(`🎉 מעולה! עכשיו אתה מוכן להתחיל לכתוב את ${typeNames[type]} שלך!
            
💡 טיפ: שמור את המתווה בצד וכתוב לפיו את החיבור במחברת או במחשב.
🔍 זכור לבדוק שגיאות כתיב בזמן הכתיבה!
            
בהצלחה! 🚀`);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.btn-primary, .btn-secondary');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });

            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#667eea';
                    this.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
                });

                input.addEventListener('blur', function() {
                    this.style.borderColor = '#e1e1e1';
                    this.style.boxShadow = 'none';
                });
            });
        });

        window.addEventListener('error', function(event) {
            return true;
        });

        function autoSave() {
            try {
                if (currentEssayType && typeof(Storage) !== "undefined") {
                    const formData = {};
                    const inputs = document.querySelectorAll(`#${currentEssayType} input, #${currentEssayType} textarea`);
                    inputs.forEach(input => {
                        if (input.value.trim()) {
                            formData[input.id] = input.value;
                        }
                    });
                    
                    localStorage.setItem(`essay_${currentEssayType}`, JSON.stringify(formData));
                }
            } catch (error) {
                // שמירה שקטה
            }
        }

        function loadSavedWork() {
            try {
                if (currentEssayType && typeof(Storage) !== "undefined") {
                    const savedData = localStorage.getItem(`essay_${currentEssayType}`);
                    if (savedData) {
                        const formData = JSON.parse(savedData);
                        Object.keys(formData).forEach(fieldId => {
                            const field = document.getElementById(fieldId);
                            if (field) {
                                field.value = formData[fieldId];
                            }
                        });
                        showSuccessMessage('נטענה עבודה שמורה קודמת! 📂');
                    }
                }
            } catch (error) {
                // טעינה שקטה
            }
        }

        setInterval(autoSave, 30000);
    </script>
</body>
</html>
                 הגדרות בדיקת שגיאות כתיב ותחביר</h4>
                    <div class="spell-check-options">
                        <div class="spell-check-option selected" data-method="basic">
                            <strong>בדיקה בסיסית</strong><br>
                            <small>בדיקת מילים נפוצות ותחביר בסיסי</small>
                        </div>
                        <div class="spell-check-option" data-method="advanced">
                            <strong>בדיקה מתקדמת</strong><br>
                            <small>בדיקה מעמיקה עם AI</small>
                        </div>
                        <div class="spell-check-option" data-method="languagetool">
                            <strong>LanguageTool</strong><br>
                            <small>בדיקה מקצועית (דורש חיבור לאינטרנט)</small>
                        </div>
                    </div>
                    <p style="text-align: center; font-size: 14px; color: #666;">
                        💡 המערכת תבדוק שגיאות כתיב ותחביר אוטומטית בזמן הכתיבה
                    </p>
                </div>
                
                <div class="card">
                    <h3>תכנון החיבור הטיעוני שלך 🎯</h3>
                    
                    <div class="input-group">
                        <label for="argTopic">מה הנושא של החיבור?</label>
                        <div class="input-with-spell-check">
                            <input type="text" id="argTopic" placeholder="למשל: השפעת הטכנולוגיה על החברה המודרנית" oninput="checkSpelling(this)">
                            <button class="spell-check-btn" onclick="manualSpellCheck('argTopic')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="argPosition">מה הטענה שלך?</label>
                        <div class="input-with-spell-check">
                            <textarea id="argPosition" class="textarea-large" placeholder="הצג בבירור מה הטענה שלך בנושא..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('argPosition')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="argArguments">3 טיעונים עיקריים התומכים בטענה שלך:</label>
                        <div class="input-with-spell-check">
                            <textarea id="argArguments" class="textarea-large" placeholder="טיעון 1: ...&#10;טיעון 2: ...&#10;טיעון 3: ..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('argArguments')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="argCounterArgument">טענת הנגד:</label>
                        <div class="input-with-spell-check">
                            <textarea id="argCounterArgument" class="textarea-large" placeholder="יש הטוענים כי..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('argCounterArgument')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="argRefutation">ההפרכה שלך לטענת הנגד:</label>
                        <div class="input-with-spell-check">
                            <textarea id="argRefutation" class="textarea-large" placeholder="אולם טענה זו שגויה מכיוון ש..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('argRefutation')">✓ בדוק</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="argSummary">סיכום והמלצה:</label>
                        <div class="input-with-spell-check">
                            <textarea id="argSummary" class="textarea-large" placeholder="סכם את טענתך וכתוב המלצה..." oninput="checkSpelling(this)"></textarea>
                            <button class="spell-check-btn" onclick="manualSpellCheck('argSummary')">✓ בדוק</button>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn-secondary" onclick="checkAllSpelling('argumentative')">🔍 בדוק שגיאות בכל הטקסט</button>
                        <button class="btn-primary" onclick="generateOutline('argumentative')">צור מתווה לחיבור 🚀</button>
                    </div>
                    <div id="argOutline"></div>
                </div>

                <div class="tips-box">
                    <h4>🎯 טיפים לחיבור טיעוני מוצלח</h4>
                    
                    <div class="tip-section">
                        <h5>🏗️ מבנה חזק</h5>
                        <ul>
                            <li>פתיחה: הצג את הנושא ואת העמדה שלך בבירור</li>
                            <li>גוף החיבור יכלול: 4 עד 6 פסקאות, כל פסקה תכלול דוגמה/הוכחה</li>
                            <li>התייחסות לעמדה נגדית והפרכה שלה</li>
                            <li>מסקנה: סיכום הטענה שלך ומסקנה</li>
                        </ul>
                        <div class="example-box">
                            <strong>דוגמה לפתיחה:</strong> "בשנים האחרונות חלה עלייה בשימוש בכלי הבינה המלאכותית ליצירת חיבורים."
                        </div>
                    </div>

                    <div class="tip-section">
                        <h5>💪 טיפים מעשיים</h5>
                        <ul>
                            <li>השתמש בדוגמאות קונקרטיות ומקורות אמינים</li>
                            <li>כל פסקה תתיחס להיבט שונה</li>
                            <li>מילות קישור: "ראשית", "שנית", "יתרה מכך", "לכן"</li>
                            <li>זכור שאתה צריך להתיחס לטענת הנגד ולהפריך אותה</li>
                        </ul>
                        <div class="example-box">
                            <strong>דוגמה למעבר מפסקה לפסקה:</strong> "בנוסף לכך, חשוב לציין כי..." או "מצד שני, יש לזכור ש..."
                        </div>
                    </div>
                </div>
            </div>

            <!-- כתיבה יצירתית -->
            <div class="step-content" id="descriptive">
                <div class="progress-indicator">תכנון כתיבה יצירתית 🎨</div>
                
                <button class="btn-secondary back-btn" onclick="goBack()">← חזרה לבחירת סוג חיבור</button>

                <!-- מודול בדיקת שגיאות כתיב -->
                <div class="spell-check-controls">
                    <h4>🔍
